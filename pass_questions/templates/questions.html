<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questions Library | Passco Student Hub</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF.js for PDF rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <!-- Configure Tailwind for a modern slate/green dark theme -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'accent-green': '#10b981',      // Emerald 500
                        'bg-dark': '#0f172a',           // Slate 900 (The "light black")
                        'bg-light': '#f1f5f9',          // Slate 100
                        'card-dark': '#1e293b',         // Slate 800
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'header-glow': '0 4px 15px rgba(0, 0, 0, 0.2)',
                        'card-shadow': '0 10px 30px rgba(0, 0, 0, 0.3)',
                    }
                }
            }
        }
        
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .dark {
            background-color: #0f172a; 
            color: #e2e8f0; 
        }

        .light {
            color: #1e293b;
        }

        .main-container {
            min-height: calc(100vh - 80px); 
        }

        /* Custom Card Style for Premium Look */
        .premium-card {
            background-color: #1e293b;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .light .premium-card {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .premium-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
        }

        .light .premium-card:hover {
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
        }

        /* Exam card styling */
        .exam-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .light .exam-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(241, 245, 249, 0.9));
            border: 1px solid #e2e8f0;
            color: #1e293b;
        }
        
        .exam-card:hover {
            border-color: rgba(16, 185, 129, 0.3);
            transform: translateY(-3px);
        }

        /* Loading animation */
        .loading-spinner {
            border: 3px solid rgba(16, 185, 129, 0.3);
            border-radius: 50%;
            border-top: 3px solid #10b981;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Badge styles */
        .level-badge {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .semester-badge {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        /* Program navigation styles */
        .program-nav {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .light .program-nav {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
        }

        .program-item {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .program-item:hover {
            border-color: rgba(16, 185, 129, 0.3);
            background: rgba(16, 185, 129, 0.1);
        }

        .program-item.active {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.2);
        }

        /* Course accordion styles */
        .course-accordion {
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .light .course-accordion {
            border: 1px solid #e2e8f0;
        }
        
        .course-accordion:hover {
            border-color: rgba(16, 185, 129, 0.3);
        }

        .course-header {
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .course-header:hover {
            background: rgba(16, 185, 129, 0.1);
        }

        .course-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .course-content.open {
            max-height: 500px;
        }

        /* Filter Section Styles */
        .filter-section {
            display: none;
            margin-bottom: 1.5rem;
        }

        .filter-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-input {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: white;
            flex: 1;
            min-width: 200px;
        }

        .light .filter-input {
            background: #ffffff;
            border: 1px solid #cbd5e1;
            color: #1e293b;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #10b981;
        }

        .filter-year-input {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: white;
            min-width: 150px;
        }

        .light .filter-year-input {
            background: #ffffff;
            border: 1px solid #cbd5e1;
            color: #1e293b;
        }
        
        .filter-year-input:focus {
            outline: none;
            border-color: #10b981;
        }

        /* Enhanced PDF Viewer Styles */
        .pdf-viewer-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.98);
            z-index: 50;
            backdrop-filter: blur(10px);
        }

        .light .pdf-viewer-container {
            background: rgba(255, 255, 255, 0.98);
        }
        
        .pdf-viewer-content {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 0;
        }

        .pdf-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(30, 41, 59, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .light .pdf-viewer-header {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #e2e8f0;
        }
        
        .pdf-viewer-body {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        /* PDF.js Canvas Container */
        .pdf-canvas-container {
            flex: 1;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 1rem;
            background: #f8fafc;
        }

        .pdf-page-canvas {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
            max-width: 100%;
            height: auto;
        }

        /* PDF Controls */
        .pdf-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(30, 41, 59, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .light .pdf-controls {
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid #e2e8f0;
        }
        
        .pdf-control-btn {
            background: rgba(16, 185, 129, 0.8);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.875rem;
        }

        .pdf-control-btn:hover {
            background: rgba(16, 185, 129, 1);
        }

        .pdf-control-btn:disabled {
            background: rgba(75, 85, 99, 0.6);
            cursor: not-allowed;
        }

        .pdf-page-info {
            color: white;
            font-size: 0.875rem;
            min-width: 80px;
            text-align: center;
        }

        .light .pdf-page-info {
            color: #1e293b;
        }
        
        .pdf-zoom-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pdf-zoom-btn {
            background: rgba(55, 65, 81, 0.8);
            border: none;
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 0.375rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .light .pdf-zoom-btn {
            background: rgba(203, 213, 225, 0.8);
            color: #1e293b;
        }
        
        .pdf-zoom-btn:hover {
            background: rgba(75, 85, 99, 0.8);
        }

        .light .pdf-zoom-btn:hover {
            background: rgba(148, 163, 184, 0.8);
        }
        
        /* PDF Loading */
        .pdf-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #6b7280;
        }

        /* Disabled button styles */
        .disabled-btn {
            background-color: #4b5563 !important;
            color: #9ca3af !important;
            cursor: not-allowed !important;
        }

        .disabled-btn:hover {
            background-color: #4b5563 !important;
            transform: none !important;
        }

        /* Profile dropdown */
        .profile-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 0.5rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            z-index: 40;
        }

        .dark .profile-dropdown {
            background: #1e293b;
            border-color: #374151;
        }

        .profile-dropdown.show {
            display: block;
        }

        /* User initials avatar */
        .user-initials {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #059669);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        /* Program card with image and overlay */
        .program-card {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            border-radius: 0.75rem;
            transition: all 0.3s ease;
        }

        .program-card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .program-card-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.3));
            display: flex;
            align-items: flex-end;
            padding: 1rem;
            color: white;
        }

        .program-card:hover .program-card-image {
            transform: scale(1.05);
        }

        .program-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }

        /* Course grid with images */
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
        }

        .course-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border-radius: 0.75rem;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .light .course-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(241, 245, 249, 0.95));
            border: 1px solid #e2e8f0;
            color: #1e293b;
        }
        
        .course-card:hover {
            transform: translateY(-4px);
            border-color: rgba(16, 185, 129, 0.3);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .course-image-container {
            height: 120px;
            background: linear-gradient(135deg, #10b981, #059669);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .course-image-placeholder {
            font-size: 2.5rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .course-info {
            padding: 0.75rem;
        }

        .course-title {
            font-weight: 600;
            font-size: 0.875rem;
            color: white;
            margin-bottom: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .light .course-title {
            color: #1e293b;
        }
        
        .course-details {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .light .course-details {
            color: #64748b;
        }
        
        /* Text color fixes for light mode */
        .light .text-white {
            color: #1e293b !important;
        }
        
        .light .text-slate-300,
        .light .text-slate-400 {
            color: #64748b !important;
        }
        
        .light .bg-card-dark\/50 {
            background-color: #f8fafc !important;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .pdf-controls {
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.5rem;
            }
            
            .pdf-control-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .pdf-page-info {
                min-width: 60px;
                font-size: 0.8rem;
            }
            
            .pdf-canvas-container {
                padding: 0.5rem;
            }
            
            .course-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 640px) {
            .course-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body class="bg-bg-light dark:bg-bg-dark flex flex-col min-h-screen">

    <header class="sticky top-0 z-30 bg-white/70 dark:bg-bg-dark/70 backdrop-blur-xl border-b dark:border-slate-800 shadow-header-glow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <!-- Logo Image Only -->
            <a href="/dashboard">
                <img 
                    src="/static/images/logo.png" 
                    alt="PASSCO Logo" 
                    class="h-8 w-auto md:h-10 w-auto object-contain"
                    onerror="this.onerror=null; this.src='https://via.placeholder.com/150x50/10B981/FFFFFF?text=PASSCO'"
                >
            </a>

            <!-- Desktop Navigation -->
            <nav class="hidden lg:flex space-x-6 items-center">
                <a href="/dashboard" class="nav-item text-slate-500 dark:text-slate-300 hover:text-accent-green hover:dark:text-accent-green transition duration-200 font-medium">Dashboard/Home</a>
                <a href="/questions" class="nav-item text-accent-green dark:text-accent-green transition duration-200 font-medium border-b-2 border-accent-green">Questions</a>
                <a href="/quiz" class="nav-item text-slate-500 dark:text-slate-300 hover:text-accent-green hover:dark:text-accent-green transition duration-200 font-medium">Quiz</a>
                <a href="#" class="nav-item text-slate-500 dark:text-slate-300 hover:text-accent-green hover:dark:text-accent-green transition duration-200 font-medium">Analytics</a>
                
                
            </nav>

            <!-- Mobile Menu, Theme Toggle, and Profile Container -->
            <div class="flex items-center space-x-3">
                <!-- Profile Dropdown -->
                <div class="relative">
                    <button id="profileDropdownButton" class="block p-0.5 rounded-full ring-2 ring-accent-green/70 hover:ring-accent-green transition duration-200" title="Profile">
                        <div id="userInitials" class="user-initials">
                            <!-- User initials will be dynamically set -->
                        </div>
                    </button>
                    
                    <!-- Profile Dropdown Menu -->
<div id="profileDropdown" class="profile-dropdown">
    <div class="p-4 border-b dark:border-gray-600">
        {% if user and user.username %}
            <p class="font-medium text-gray-900 dark:text-white" id="dropdownUserName">
                {{ user.username }}
            </p>
        {% else %}
            <p class="font-medium text-gray-900 dark:text-white" id="dropdownUserName">
                Welcome!
            </p>
        {% endif %}
        
        {% if user and user.email %}
            <p class="text-sm text-gray-500 dark:text-gray-400" id="dropdownUserEmail">
                {{ user.email }}
            </p>
        {% else %}
            <p class="text-sm text-gray-500 dark:text-gray-400" id="dropdownUserEmail">
                student@example.com
            </p>
        {% endif %}
    </div>
    <div class="p-2">
        {% if user and user.uid %}
            <a href="/profile" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition duration-200 flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <span>My Profile</span>
            </a>
            <a href="/settings" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition duration-200 flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <span>Settings</span>
            </a>
            <button onclick="logout()" class="w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition duration-200 flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
                <span>Logout</span>
            </button>
        {% else %}
            <a href="/auth/login" class="block px-4 py-2 text-sm text-accent-green hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition duration-200 flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                </svg>
                <span>Login</span>
            </a>
        {% endif %}
    </div>
</div>
                </div>
                
                <!-- Theme Toggle Button -->
                <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-card-dark transition duration-200">
                    <svg id="themeIcon" class="w-6 h-6 text-yellow-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>

                <!-- Mobile Menu Button -->
                <button id="menuToggle" class="p-2 rounded-lg lg:hidden hover:bg-gray-100 dark:hover:bg-card-dark transition duration-200">
                    <svg class="w-6 h-6 dark:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu Dropdown -->
        <nav id="mobileMenu" class="lg:hidden hidden px-4 pb-4 border-t dark:border-slate-800">
            <div class="flex flex-col space-y-1 mt-2">
                <a href="/dashboard" class="nav-item w-full p-3 rounded-lg dark:text-white text-slate-800 hover:bg-accent-green/10 font-medium flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    <span>Home</span>
                </a>
                <a href="/questions" class="nav-item w-full p-3 rounded-lg bg-accent-green/20 dark:text-white text-slate-800 font-bold flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span>Questions</span>
                </a>
                <a href="/quiz" class="nav-item w-full p-3 rounded-lg dark:text-white text-slate-800 hover:bg-accent-green/10 font-medium flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                    <span>Quiz</span>
                </a>
                <a href="#" class="nav-item w-full p-3 rounded-lg dark:text-white text-slate-800 hover:bg-accent-green/10 font-medium flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    <span>Analytics</span>
                </a>
                    
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-7xl mx-auto w-full p-4 sm:p-8 main-container">
        
        <!-- Page Header -->
        <div class="bg-gradient-to-r from-accent-green/10 to-transparent p-6 sm:p-8 rounded-xl mb-8 border border-accent-green/30 shadow-lg">
            <h1 class="text-3xl sm:text-4xl font-extrabold dark:text-white text-slate-800 tracking-tight mb-2">
                Questions Library
            </h1>
            <p class="text-slate-600 dark:text-slate-400 text-lg">
                Access past exam papers, solutions, and study materials. Browse by program and course to find exactly what you need.
            </p>
        </div>

        <!-- Program Navigation -->
        <div class="premium-card p-6 rounded-xl mb-8 program-nav">
            <h2 class="text-xl font-bold text-accent-green mb-4">Select Program</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="programNav">
                <!-- Programs will be dynamically loaded here -->
            </div>
        </div>

        <!-- Filter Section -->
        <div id="filterSection" class="filter-section premium-card p-6 rounded-xl mb-8">
            <h2 class="text-xl font-bold text-accent-green mb-4">Filter Courses</h2>
            <div class="filter-container">
                <input type="text" id="searchInput" class="filter-input" placeholder="Search courses...">
                <input type="number" id="yearFilter" class="filter-year-input" placeholder="Enter year (e.g., 2023)" min="2000" max="2030">
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-12">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-slate-600 dark:text-slate-400">Loading exam materials...</p>
        </div>

        <!-- No Results State -->
        <div id="noResultsState" class="hidden text-center py-12">
            <div class="text-slate-600 dark:text-slate-400 mb-4">
                <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-slate-700 dark:text-slate-300 mb-2">No exams found</h3>
            <p class="text-slate-600 dark:text-slate-400">Select a program to view available courses and exams.</p>
        </div>

        <!-- Courses and Exams Section -->
        <div id="coursesSection" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold dark:text-white text-slate-800" id="selectedProgramTitle">Available Courses</h2>
                <span id="resultsCount" class="text-slate-600 dark:text-slate-400 text-sm"></span>
            </div>

            <!-- Courses Grid -->
            <div id="coursesGrid" class="course-grid mb-8">
                <!-- Courses will be dynamically loaded here in grid format -->
            </div>

            <!-- Courses Accordion (for detailed view) -->
            <div id="coursesAccordion" class="space-y-4">
                <!-- Courses will be dynamically loaded here in accordion format -->
            </div>
        </div>

        <!-- Enhanced PDF Viewer Modal -->
        <div id="pdfViewer" class="pdf-viewer-container">
            <div class="pdf-viewer-content">
                <div class="pdf-viewer-header">
                    <h2 id="pdfViewerTitle" class="text-xl font-bold dark:text-white text-slate-800">PDF Viewer</h2>
                    <button onclick="closePdfViewer()" class="text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="pdf-viewer-body">
                    <div id="pdfLoading" class="pdf-loading">
                        <div class="loading-spinner mx-auto mb-4"></div>
                        <p>Loading PDF...</p>
                    </div>
                    <div id="pdfCanvasContainer" class="pdf-canvas-container" style="display: none;">
                        <!-- PDF pages will be rendered here -->
                    </div>
                </div>
                <div class="pdf-controls">
                    <button id="prevPage" class="pdf-control-btn" disabled>Previous</button>
                    <span id="pageInfo" class="pdf-page-info">Page 1 of 1</span>
                    <button id="nextPage" class="pdf-control-btn" disabled>Next</button>
                    <div class="pdf-zoom-controls">
                        <button id="zoomOut" class="pdf-zoom-btn">-</button>
                        <span id="zoomLevel" class="pdf-page-info">100%</span>
                        <button id="zoomIn" class="pdf-zoom-btn">+</button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="mt-8 py-6 border-t dark:border-slate-800 border-slate-200 bg-white/5 dark:bg-bg-dark/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex flex-col md:flex-row justify-between items-center space-y-3 md:space-y-0">
                <p class="text-sm text-slate-600 dark:text-slate-400">
                    &copy; <span id="currentYear"></span> Passco Student Hub. All rights reserved.
                </p>
            </div> 
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            // Add your Firebase config here
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // PDF.js variables
        let currentPdf = null;
        let currentPageNum = 1;
        let totalPages = 0;
        let scale = 1.5;

        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body.parentElement;
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const menuToggle = document.getElementById('menuToggle');
            const mobileMenu = document.getElementById('mobileMenu');
            const currentYear = document.getElementById('currentYear');
            const profileDropdownButton = document.getElementById('profileDropdownButton');
            const profileDropdown = document.getElementById('profileDropdown');
            const userInitials = document.getElementById('userInitials');
            const dropdownUserName = document.getElementById('dropdownUserName');
            const dropdownUserEmail = document.getElementById('dropdownUserEmail');
            
            // PDF controls
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            const pageInfo = document.getElementById('pageInfo');
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');
            const zoomLevel = document.getElementById('zoomLevel');
            const pdfLoading = document.getElementById('pdfLoading');
            const pdfCanvasContainer = document.getElementById('pdfCanvasContainer');
            
            // Set current year
            currentYear.textContent = new Date().getFullYear();

            // Load user data from Flask session
function loadUserData() {
    try {
        {% if user and user.username %}
            // User data is available from Flask session
            const userName = "{{ user.username }}";
            const userEmail = "{{ user.email }}";
            
            // Set user initials
            const initials = getUserInitials(userName);
            userInitials.textContent = initials;
            dropdownUserName.textContent = userName;
            dropdownUserEmail.textContent = userEmail;
        {% else %}
            // Fallback to default if no user data in session
            setDefaultUserData();
        {% endif %}
    } catch (error) {
        console.error('Error loading user data:', error);
        // Fallback to default
        setDefaultUserData();
    }
}

function setDefaultUserData() {
    const userName = "Student User";
    const userEmail = "student@example.com";
    const initials = getUserInitials(userName);
    userInitials.textContent = initials;
    dropdownUserName.textContent = userName;
    dropdownUserEmail.textContent = userEmail;
}

function getUserInitials(name) {
    return name.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2);
}

// Load user data
loadUserData();

            // Theme Toggle Logic
            let theme = localStorage.getItem('theme') || 'dark';
            
            const updateTheme = (newTheme) => {
                body.classList.remove('light', 'dark');
                body.classList.add(newTheme);
                localStorage.setItem('theme', newTheme);
                theme = newTheme;
                
                if (newTheme === 'dark') {
                    themeIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>`;
                    themeIcon.classList.remove('text-slate-700');
                    themeIcon.classList.add('text-yellow-500');
                } else {
                    themeIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>`;
                    themeIcon.classList.remove('text-yellow-500');
                    themeIcon.classList.add('text-slate-700');
                }
            };
            
            updateTheme(theme);
            
            themeToggle.addEventListener('click', () => {
                const newTheme = theme === 'dark' ? 'light' : 'dark';
                updateTheme(newTheme);
            });

            // Mobile Menu Toggle
            menuToggle.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            mobileMenu.querySelectorAll('.nav-item').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                });
            });

            // Profile Dropdown Toggle
            profileDropdownButton.addEventListener('click', (e) => {
                e.stopPropagation();
                profileDropdown.classList.toggle('show');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', () => {
                profileDropdown.classList.remove('show');
            });

            // Prevent dropdown from closing when clicking inside
            profileDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Exam Data Management
            let allExams = [];
            let currentProgram = '';
            let filteredExams = [];

            // DOM Elements
            const programNav = document.getElementById('programNav');
            const loadingState = document.getElementById('loadingState');
            const noResultsState = document.getElementById('noResultsState');
            const coursesSection = document.getElementById('coursesSection');
            const coursesGrid = document.getElementById('coursesGrid');
            const coursesAccordion = document.getElementById('coursesAccordion');
            const selectedProgramTitle = document.getElementById('selectedProgramTitle');
            const resultsCount = document.getElementById('resultsCount');
            const filterSection = document.getElementById('filterSection');
            const searchInput = document.getElementById('searchInput');
            const yearFilter = document.getElementById('yearFilter');

            // Program images mapping
            const programImages = {
                'Computer Science': 'https://images.unsplash.com/photo-1517077304055-6e89abbf09b0?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80',
                'Information Technology': 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80',
                'Electrical Engineering': 'https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80',
                'Mechanical Engineering': 'https://images.unsplash.com/photo-1581094794329-c8112a89af12?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80',
                'Civil Engineering': 'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80',
                'Business Administration': 'https://images.unsplash.com/photo-1553877522-43269d4ea984?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80',
                'Accounting': 'https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80',
                'Marketing': 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80'
            };

            // Course icons/placeholders mapping
            const courseIcons = {
                'Programming': 'ðŸ’»',
                'Mathematics': 'ðŸ§®',
                'Physics': 'âš›ï¸',
                'Chemistry': 'ðŸ§ª',
                'Business': 'ðŸ“Š',
                'Engineering': 'âš™ï¸',
                'Design': 'ðŸŽ¨',
                'Science': 'ðŸ”¬',
                'Economics': 'ðŸ“ˆ',
                'Management': 'ðŸ‘”'
            };

            // Get icon for course
            function getCourseIcon(courseName) {
                const courseLower = courseName.toLowerCase();
                for (const [key, icon] of Object.entries(courseIcons)) {
                    if (courseLower.includes(key.toLowerCase())) {
                        return icon;
                    }
                }
                // Default icons based on program
                if (courseLower.includes('programming') || courseLower.includes('coding') || courseLower.includes('software')) {
                    return 'ðŸ’»';
                } else if (courseLower.includes('math') || courseLower.includes('calculus') || courseLower.includes('algebra')) {
                    return 'ðŸ§®';
                } else if (courseLower.includes('physics') || courseLower.includes('mechanics')) {
                    return 'âš›ï¸';
                } else if (courseLower.includes('business') || courseLower.includes('management') || courseLower.includes('marketing')) {
                    return 'ðŸ“Š';
                } else if (courseLower.includes('engineering') || courseLower.includes('technical')) {
                    return 'âš™ï¸';
                } else {
                    return 'ðŸ“š'; // Default book icon
                }
            }

            // Fetch exams from API
            async function fetchExams() {
                try {
                    const response = await fetch('/api/exams');
                    const exams = await response.json();
                    
                    if (response.ok) {
                        allExams = exams;
                        console.log('Loaded exams:', exams);
                        initializePrograms();
                    } else {
                        throw new Error('Failed to fetch exams');
                    }
                } catch (error) {
                    console.error('Error fetching exams:', error);
                    showError('Failed to load exams. Please try again later.');
                } finally {
                    loadingState.classList.add('hidden');
                }
            }

            // Initialize programs from exam data - UPDATED WITH IMAGE CARDS
            function initializePrograms() {
                const programs = [...new Set(allExams.map(exam => exam.program))].sort();
                
                if (programs.length === 0) {
                    noResultsState.classList.remove('hidden');
                    return;
                }

                programNav.innerHTML = programs.map(program => {
                    const imageUrl = programImages[program] || 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80';
                    const defaultIcon = getCourseIcon(program);
                    
                    return `
                        <button class="program-card program-item" 
                                data-program="${program}"
                                onclick="selectProgram('${program}')">
                            <img src="${imageUrl}" alt="${program}" class="program-card-image" 
                                 onerror="this.src='https://images.unsplash.com/photo-1516321318423-f06f85e504b3?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80'">
                            <div class="program-card-overlay">
                                <div>
                                    <h3 class="font-bold text-lg mb-1">${program}</h3>
                                    <p class="text-sm text-gray-300">Browse courses</p>
                                </div>
                            </div>
                        </button>
                    `;
                }).join('');

                noResultsState.classList.remove('hidden');
            }

            // Select program and show courses
            window.selectProgram = function(program) {
                currentProgram = program;
                
                // Update active state
                document.querySelectorAll('.program-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-program="${program}"]`).classList.add('active');
                
                // Show courses section and filter section
                selectedProgramTitle.textContent = `${program} - Available Courses`;
                coursesSection.classList.remove('hidden');
                filterSection.style.display = 'block';
                noResultsState.classList.add('hidden');
                
                // Load courses for selected program
                loadCoursesForProgram(program);
            }

            // Load courses for selected program - UPDATED WITH GRID VIEW
            function loadCoursesForProgram(program) {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedYear = yearFilter.value;
                
                let programExams = allExams.filter(exam => exam.program === program);
                
                // Apply filters
                if (searchTerm) {
                    programExams = programExams.filter(exam => 
                        exam.course.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (selectedYear) {
                    programExams = programExams.filter(exam => exam.year == selectedYear);
                }
                
                filteredExams = programExams;
                const courses = [...new Set(programExams.map(exam => exam.course))].sort();
                
                if (courses.length === 0) {
                    coursesGrid.innerHTML = `
                        <div class="col-span-full text-center py-8 text-slate-600 dark:text-slate-400">
                            <p>No courses found for ${program}.</p>
                        </div>
                    `;
                    coursesAccordion.innerHTML = '';
                    return;
                }

                resultsCount.textContent = `${courses.length} course${courses.length !== 1 ? 's' : ''} available`;

                // Render courses in grid format
                coursesGrid.innerHTML = courses.map(course => {
                    const courseExams = programExams.filter(exam => exam.course === course);
                    const levels = [...new Set(courseExams.map(exam => exam.level))].sort();
                    const icon = getCourseIcon(course);
                    
                    return `
                        <div class="course-card" onclick="openCourseDetails('${course}')">
                            <div class="course-image-container">
                                <div class="course-image-placeholder">${icon}</div>
                            </div>
                            <div class="course-info">
                                <h3 class="course-title">${course}</h3>
                                <p class="course-details">${levels.length} level${levels.length !== 1 ? 's' : ''} â€¢ Click to view exams</p>
                            </div>
                        </div>
                    `;
                }).join('');

                // Also render detailed accordion (initially hidden)
                coursesAccordion.innerHTML = courses.map(course => {
                    const courseExams = programExams.filter(exam => exam.course === course);
                    const levels = [...new Set(courseExams.map(exam => exam.level))].sort();
                    
                    return `
                        <div class="course-accordion rounded-lg overflow-hidden hidden">
                            <div class="course-header p-4 bg-card-dark/50 dark:bg-card-dark/50 flex justify-between items-center" 
                                 onclick="toggleCourse('${course}')">
                                <div>
                                    <h3 class="font-bold dark:text-white text-slate-800">${course}</h3>
                                    <p class="text-slate-600 dark:text-slate-400 text-sm">${levels.length} level${levels.length !== 1 ? 's' : ''} available</p>
                                </div>
                                <svg class="w-5 h-5 text-accent-green transform transition-transform" id="icon-${course}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                            <div class="course-content bg-card-dark/30 dark:bg-card-dark/30" id="content-${course}">
                                <div class="p-4">
                                    ${renderCourseExams(courseExams)}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Open course details (shows accordion view)
            window.openCourseDetails = function(course) {
                // Show only the selected course accordion
                document.querySelectorAll('.course-accordion').forEach(acc => {
                    acc.classList.add('hidden');
                });
                
                const courseElement = Array.from(document.querySelectorAll('.course-accordion')).find(el => 
                    el.querySelector('h3').textContent === course
                );
                
                if (courseElement) {
                    courseElement.classList.remove('hidden');
                    // Scroll to the accordion
                    courseElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    // Open the accordion
                    toggleCourse(course);
                }
            }

            // Toggle course accordion
            window.toggleCourse = function(course) {
                const content = document.getElementById(`content-${course}`);
                const icon = document.getElementById(`icon-${course}`);
                
                content.classList.toggle('open');
                icon.classList.toggle('rotate-180');
            }

            // Render exams for a course
            function renderCourseExams(exams) {
                const groupedByLevel = exams.reduce((acc, exam) => {
                    const level = exam.level || 'Unknown';
                    if (!acc[level]) acc[level] = [];
                    acc[level].push(exam);
                    return acc;
                }, {});

                return Object.keys(groupedByLevel).sort().map(level => {
                    const levelExams = groupedByLevel[level];
                    
                    // Group by year to combine questions and answers
                    const examsByYear = levelExams.reduce((acc, exam) => {
                        const year = exam.year || 'Unknown';
                        if (!acc[year]) {
                            acc[year] = {
                                questions: null,
                                answers: null,
                                semester: exam.semester || '1',
                                exam_type: exam.exam_type || 'final'
                            };
                        }
                        
                        if (exam.exam_type === 'questions' || exam.questionsFilePath) {
                            acc[year].questions = exam;
                        }
                        if (exam.exam_type === 'answers' || exam.answersFilePath) {
                            acc[year].answers = exam;
                        }
                        
                        return acc;
                    }, {});

                    return `
                        <div class="mb-4">
                            <h4 class="font-semibold text-accent-green mb-2">Level ${level}</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                ${Object.keys(examsByYear).sort().reverse().map(year => {
                                    const examData = examsByYear[year];
                                    const hasQuestions = examData.questions && 
                                                        examData.questions.questionsFilePath && 
                                                        examData.questions.questionsFilePath !== '';
                                    const hasAnswers = examData.answers && 
                                                      examData.answers.answersFilePath && 
                                                      examData.answers.answersFilePath !== '';
                                    
                                    // If no files available, skip this year
                                    if (!hasQuestions && !hasAnswers) {
                                        return '';
                                    }

                                    return `
                                        <div class="exam-card p-3 rounded-lg">
                                            <div class="flex justify-between items-start mb-3">
                                                <div>
                                                    <p class="font-medium dark:text-white text-slate-800 text-sm">${year}</p>
                                                    <p class="text-slate-600 dark:text-slate-400 text-xs capitalize">${examData.exam_type || 'final'} exam</p>
                                                </div>
                                                <span class="semester-badge px-2 py-1 text-xs text-white rounded-full">
                                                    Sem ${examData.semester}
                                                </span>
                                            </div>
                                            <div class="flex space-x-2">
                                                ${hasQuestions ? `
                                                    <button onclick="openPdfViewer('${examData.questions.questionsFilePath}', '${examData.questions.course} - Questions - ${year}')" 
                                                       class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-center py-2 px-3 rounded text-sm font-medium transition duration-200">
                                                        ðŸ“ Questions
                                                    </button>
                                                ` : `
                                                    <button class="flex-1 bg-gray-600 text-gray-400 text-center py-2 px-3 rounded text-sm font-medium cursor-not-allowed disabled-btn">
                                                        ðŸ“ Unavailable
                                                    </button>
                                                `}
                                                
                                                ${hasAnswers ? `
                                                    <button onclick="openPdfViewer('${examData.answers.answersFilePath}', '${examData.answers.course} - Answers - ${year}')" 
                                                       class="flex-1 bg-green-600 hover:bg-green-700 text-white text-center py-2 px-3 rounded text-sm font-medium transition duration-200">
                                                        âœ… Answers
                                                    </button>
                                                ` : `
                                                    <button class="flex-1 bg-gray-600 text-gray-400 text-center py-2 px-3 rounded text-sm font-medium cursor-not-allowed disabled-btn">
                                                        âœ… Unavailable
                                                    </button>
                                                `}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // ENHANCED PDF Viewer using PDF.js
            window.openPdfViewer = async function(pdfUrl, title) {
                console.log('Opening PDF:', pdfUrl, 'Title:', title);
                
                // Ensure the URL is properly formatted
                let finalUrl = pdfUrl;
                
                // If it's a relative path without /static/pdfs/, add it
                if (!pdfUrl.startsWith('/') && !pdfUrl.startsWith('http')) {
                    finalUrl = '/static/pdfs/' + pdfUrl;
                }
                
                // If it starts with /pdf/, convert to /static/pdfs/
                if (pdfUrl.startsWith('/pdf/')) {
                    finalUrl = pdfUrl.replace('/pdf/', '/static/pdfs/');
                }
                
                // If it's a full path but missing the /static/pdfs/ prefix
                if (pdfUrl.includes('CS BTech') && !pdfUrl.startsWith('/static/pdfs/')) {
                    finalUrl = '/static/pdfs/' + pdfUrl;
                }
                
                console.log('Final PDF URL:', finalUrl);
                
                // Show PDF viewer
                document.getElementById('pdfViewerTitle').textContent = title;
                document.getElementById('pdfViewer').style.display = 'block';
                document.body.style.overflow = 'hidden';
                
                // Show loading state
                pdfLoading.style.display = 'flex';
                pdfCanvasContainer.style.display = 'none';
                
                try {
                    // Reset PDF state
                    currentPageNum = 1;
                    scale = 1.5;
                    
                    // Load PDF using PDF.js
                    const loadingTask = pdfjsLib.getDocument(finalUrl);
                    currentPdf = await loadingTask.promise;
                    totalPages = currentPdf.numPages;
                    
                    // Update page info
                    updatePageInfo();
                    
                    // Render first page
                    await renderPage(currentPageNum);
                    
                    // Show PDF content
                    pdfLoading.style.display = 'none';
                    pdfCanvasContainer.style.display = 'flex';
                    
                } catch (error) {
                    console.error('Error loading PDF:', error);
                    pdfLoading.innerHTML = `
                        <div class="text-center text-red-400">
                            <p>Error loading PDF: ${error.message}</p>
                            <button onclick="closePdfViewer()" class="pdf-control-btn mt-4">Close</button>
                        </div>
                    `;
                }
            }

            // Render PDF page
            async function renderPage(pageNum) {
                if (!currentPdf) return;
                
                const page = await currentPdf.getPage(pageNum);
                const viewport = page.getViewport({ scale: scale });
                
                // Create canvas for this page
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                canvas.className = 'pdf-page-canvas';
                
                // Clear container and add new canvas
                pdfCanvasContainer.innerHTML = '';
                pdfCanvasContainer.appendChild(canvas);
                
                // Render PDF page
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                await page.render(renderContext).promise;
                
                // Update controls
                updatePageControls();
            }

            // Update page information
            function updatePageInfo() {
                pageInfo.textContent = `Page ${currentPageNum} of ${totalPages}`;
                zoomLevel.textContent = `${Math.round(scale * 100)}%`;
            }

            // Update page controls
            function updatePageControls() {
                prevPageBtn.disabled = currentPageNum <= 1;
                nextPageBtn.disabled = currentPageNum >= totalPages;
                updatePageInfo();
            }

            // PDF control event listeners
            prevPageBtn.addEventListener('click', async () => {
                if (currentPageNum > 1) {
                    currentPageNum--;
                    await renderPage(currentPageNum);
                }
            });

            nextPageBtn.addEventListener('click', async () => {
                if (currentPageNum < totalPages) {
                    currentPageNum++;
                    await renderPage(currentPageNum);
                }
            });

            zoomInBtn.addEventListener('click', async () => {
                scale = Math.min(scale + 0.25, 3);
                await renderPage(currentPageNum);
            });

            zoomOutBtn.addEventListener('click', async () => {
                scale = Math.max(scale - 0.25, 0.5);
                await renderPage(currentPageNum);
            });

            window.closePdfViewer = function() {
                document.getElementById('pdfViewer').style.display = 'none';
                document.body.style.overflow = 'auto';
                
                // Clean up
                if (currentPdf) {
                    currentPdf.destroy();
                    currentPdf = null;
                }
                pdfCanvasContainer.innerHTML = '';
                pdfLoading.style.display = 'flex';
                pdfLoading.innerHTML = `
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p>Loading PDF...</p>
                `;
            }

            // Logout function
            window.logout = async function() {
                try {
                    // Try Firebase logout first
                    await firebase.auth().signOut();
                    
                    // Then call your backend logout
                    const response = await fetch('/auth/logout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    if (response.ok) {
                        window.location.href = '/auth/login';
                    } else {
                        // If backend logout fails, still redirect to login
                        window.location.href = '/auth/login';
                    }
                } catch (error) {
                    console.error('Logout error:', error);
                    // Fallback: redirect to login page
                    window.location.href = '/auth/login';
                }
            }

            // Filter event listeners
            searchInput.addEventListener('input', () => {
                if (currentProgram) {
                    loadCoursesForProgram(currentProgram);
                }
            });

            yearFilter.addEventListener('input', () => {
                if (currentProgram) {
                    loadCoursesForProgram(currentProgram);
                }
            });

            // Show error message
            function showError(message) {
                coursesAccordion.innerHTML = `
                    <div class="text-center py-8 text-red-400">
                        <p>${message}</p>
                    </div>
                `;
            }

            // Initialize
            fetchExams();
        });
    </script>
</body>
</html>