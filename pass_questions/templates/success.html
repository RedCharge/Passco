{% extends "base.html" %}
{% block title %}Payment Successful - PassQuestion{% endblock %}

{% block content %}
<section class="min-h-screen flex flex-col items-center justify-center bg-green-50 text-center px-6 pt-32 pb-20">
  <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-lg">
    <h2 class="text-3xl font-bold mb-4 text-green-700">ðŸŽ‰ Payment Successful!</h2>
    <p class="mb-6">Thank you for your payment. Redirecting you to your dashboard...</p>
  </div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBCwtCSeI7uayrH2qL8ptMAORO217MZNVk",
  authDomain: "pastquestion-3b0cc.firebaseapp.com",
  projectId: "pastquestion-3b0cc",
  storageBucket: "pastquestion-3b0cc.appspot.com",
  messagingSenderId: "625861976863",
  appId: "1:625861976863:web:26d20e163bd6e06285862a",
  measurementId: "G-JWH9LZ6WMC"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

onAuthStateChanged(auth, async (user) => {
  if (!user) return window.location.href = "/auth/login";

  const userRef = doc(db, "users", user.uid);
  const userSnap = await getDoc(userRef);

  if (!userSnap.exists()) return alert("User not found!");
  const userData = userSnap.data();

  // Redirect after 2 seconds based on role
  setTimeout(() => {
    if (userData.role === "admin") {
      window.location.href = "/admin/dashboard";
    } else {
      window.location.href = "/dashboard";
    }
  }, 2000);
});
</script>
{% endblock %}
